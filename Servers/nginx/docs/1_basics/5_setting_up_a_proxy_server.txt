One of the frequent uses of nginx is setting it up as a proxy server, which means a server that receives requests, passes them to the proxied servers, retrieves responses from them, and sends them to the clients.

We will configure a basic proxy server, which serves requests of images with files from the local directory and sends all other requests to a proxied server. In this example, both servers will be defined on a single nginx instance.

First, define the proxied server by adding one more server block to the nginxâ€™s configuration file with the following contents:

This server listens on port 8080, and maps all requests to the /data/up1 directory on the local file system. Create this directory and put the index.html file into it. Note that the root directive is placed in the server context. Such root directive is used when the location block selected for serving a request does not include its own root directive (Me: I think it's trying to say that the location block has to have a root directive. If it doesn't, then the root directive of the server block is used.)

Next, use the server configuration from the previous section and modify it to make it a proxy server configuration. In the first location block, put the proxy_pass directive with the protocol, name and port of the proxied server specified in the parameter (in our case, it is http://localhost:8080):

Now consider the second location block. Here, we map all urls that end in .jpg, .gif or .png to the /data/images folder. As such, when the user says I want /my_image.png, we map it to /data/images/my_image.png. Note that the tilde must be used before all regular expressions. Note that when nginx selects a location block to serve a request it first checks location directives that specify prefixes, remembering location with the longest prefix, and then checks regular expressions. If there is a match with a regular expression, nginx picks this location or, otherwise, it picks the one remembered earlier.

http{
    server {
        listen 8080
        root /data/up1

    location / {
        }

    server {
        location / {
            proxy_pass http://localhost:8080;
        }

        location ~ \.(gif|jpg|png)$ {
            root /data/images;
        }
    }
}