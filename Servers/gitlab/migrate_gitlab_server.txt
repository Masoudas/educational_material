NOTE: This transfer does not move ssh keys, and server id.

First create a backup from the current version. To create a backup, we need to have rsync installed. Then, UNCOMMENT the following to /etc/gitlab/gitlab.rb (don't change it!)

# gitlab_rails['backup_gitaly_backup_path'] = '/opt/gitlab/embedded/bin/gitaly-backup'

To change backup path, change:
# gitlab_rails['backup_path'] = "/var/opt/gitlab/backups"

To create an actual backup, run the following command, and the result is in $GITLAB_HOME/gitlab/data/backup:
$ docker exec -it GITLAB_DOCKER gitlab-rake gitlab:backup:create


VERY VERY IMPORTANT NOTE: We must copy gitlab-secrets.json and gitlab.rb files BY HAND. If we don't do this, our backup won't work.

$$$$$ Restore process
The backup file must can be found in the backup path, which is defined in the configuration file /etc/gitlab/gitlab.rb by the key gitlab_rails['backup_path'].

NOTE ON SETTING THE PATH: This should not be the path in the host system, because docker image looks for the image in its own file system. It should be the mapped path, meaning the folder in the docker image, which is mapped from the host os! For example, if I have mapped  when creating the image "$GITLAB_HOME/data:/var/opt/gitlab", then the path is "/var/opt/gitlab/data/backups" and not 
"$GITLAB_HOME/data/backups"

Rerun the gitlab instance. Next, run the following command:
$ docker exec -it GITLAB_INSTANCE gitlab-rake gitlab:backup:restore --trace